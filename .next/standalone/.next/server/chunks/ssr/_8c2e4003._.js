module.exports=[12794,a=>{"use strict";var b=a.i(18544),c=a.i(85659),d=a.i(21778),e=class extends c.Removable{#a;#b;#c;#d;constructor(a){super(),this.#a=a.client,this.mutationId=a.mutationId,this.#c=a.mutationCache,this.#b=[],this.state=a.state||f(),this.setOptions(a.options),this.scheduleGc()}setOptions(a){this.options=a,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(a){this.#b.includes(a)||(this.#b.push(a),this.clearGcTimeout(),this.#c.notify({type:"observerAdded",mutation:this,observer:a}))}removeObserver(a){this.#b=this.#b.filter(b=>b!==a),this.scheduleGc(),this.#c.notify({type:"observerRemoved",mutation:this,observer:a})}optionalRemove(){this.#b.length||("pending"===this.state.status?this.scheduleGc():this.#c.remove(this))}continue(){return this.#d?.continue()??this.execute(this.state.variables)}async execute(a){let b=()=>{this.#e({type:"continue"})},c={client:this.#a,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#d=(0,d.createRetryer)({fn:()=>this.options.mutationFn?this.options.mutationFn(a,c):Promise.reject(Error("No mutationFn found")),onFail:(a,b)=>{this.#e({type:"failed",failureCount:a,error:b})},onPause:()=>{this.#e({type:"pause"})},onContinue:b,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#c.canRun(this)});let e="pending"===this.state.status,f=!this.#d.canStart();try{if(e)b();else{this.#e({type:"pending",variables:a,isPaused:f}),await this.#c.config.onMutate?.(a,this,c);let b=await this.options.onMutate?.(a,c);b!==this.state.context&&this.#e({type:"pending",context:b,variables:a,isPaused:f})}let d=await this.#d.start();return await this.#c.config.onSuccess?.(d,a,this.state.context,this,c),await this.options.onSuccess?.(d,a,this.state.context,c),await this.#c.config.onSettled?.(d,null,this.state.variables,this.state.context,this,c),await this.options.onSettled?.(d,null,a,this.state.context,c),this.#e({type:"success",data:d}),d}catch(b){try{throw await this.#c.config.onError?.(b,a,this.state.context,this,c),await this.options.onError?.(b,a,this.state.context,c),await this.#c.config.onSettled?.(void 0,b,this.state.variables,this.state.context,this,c),await this.options.onSettled?.(void 0,b,a,this.state.context,c),b}finally{this.#e({type:"error",error:b})}}finally{this.#c.runNext(this)}}#e(a){this.state=(b=>{switch(a.type){case"failed":return{...b,failureCount:a.failureCount,failureReason:a.error};case"pause":return{...b,isPaused:!0};case"continue":return{...b,isPaused:!1};case"pending":return{...b,context:a.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:a.isPaused,status:"pending",variables:a.variables,submittedAt:Date.now()};case"success":return{...b,data:a.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...b,data:void 0,error:a.error,failureCount:b.failureCount+1,failureReason:a.error,isPaused:!1,status:"error"}}})(this.state),b.notifyManager.batch(()=>{this.#b.forEach(b=>{b.onMutationUpdate(a)}),this.#c.notify({mutation:this,type:"updated",action:a})})}};function f(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}a.s(["Mutation",()=>e,"getDefaultState",()=>f])},20016,39425,71225,75192,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(9610),e=a.i(37927),f=a.i(50944),g=a.i(68317);a.i(60786);var h=a.i(81109),i=a.i(33217);a.i(82705);var j=a.i(56471);let k=async(a,b)=>{let{search:c}=b||{},d=c&&c.trim().length>0?`api/books?search=${encodeURIComponent(c.trim())}`:"api/books",e=await j.restApiFetcher.get(d,{signal:a.signal,cache:"force-cache",next:{revalidate:30}}).json();if(!e)throw Error("Books not found");return e},l={all:["books"],search:a=>[...l.all,"search",a]};var m=a.i(12794),n=a.i(18544),o=a.i(33791),p=a.i(42871),q=class extends o.Subscribable{#a;#f=void 0;#g;#h;constructor(a,b){super(),this.#a=a,this.setOptions(b),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){let b=this.options;this.options=this.#a.defaultMutationOptions(a),(0,p.shallowEqualObjects)(this.options,b)||this.#a.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#g,observer:this}),b?.mutationKey&&this.options.mutationKey&&(0,p.hashKey)(b.mutationKey)!==(0,p.hashKey)(this.options.mutationKey)?this.reset():this.#g?.state.status==="pending"&&this.#g.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#g?.removeObserver(this)}onMutationUpdate(a){this.#i(),this.#j(a)}getCurrentResult(){return this.#f}reset(){this.#g?.removeObserver(this),this.#g=void 0,this.#i(),this.#j()}mutate(a,b){return this.#h=b,this.#g?.removeObserver(this),this.#g=this.#a.getMutationCache().build(this.#a,this.options),this.#g.addObserver(this),this.#g.execute(a)}#i(){let a=this.#g?.state??(0,m.getDefaultState)();this.#f={...a,isPending:"pending"===a.status,isSuccess:"success"===a.status,isError:"error"===a.status,isIdle:"idle"===a.status,mutate:this.mutate,reset:this.reset}}#j(a){n.notifyManager.batch(()=>{if(this.#h&&this.hasListeners()){let b=this.#f.variables,c=this.#f.context,d={client:this.#a,meta:this.options.meta,mutationKey:this.options.mutationKey};a?.type==="success"?(this.#h.onSuccess?.(a.data,b,c,d),this.#h.onSettled?.(a.data,null,b,c,d)):a?.type==="error"&&(this.#h.onError?.(a.error,b,c,d),this.#h.onSettled?.(void 0,a.error,b,c,d))}this.listeners.forEach(a=>{a(this.#f)})})}};async function r(){let a=await j.restApiFetcher.get("api/favorites");if(!a.ok)return[];let b=await a.json();return Array.isArray(b)?b:[]}async function s(a){return await j.restApiFetcher.post("api/favorites",{json:{bookId:a}}).json()}async function t(a){return await j.restApiFetcher.delete(`api/favorites?bookId=${a}`).json()}let u=["favorites"];a.i(23786);var v=a.i(58360);a.s(["default",0,()=>{let[a,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(!0),m=(0,d.useTranslations)("Auth"),n=(0,e.useQueryClient)(),o=(0,f.useRouter)(),{data:p,isLoading:q,error:r}=(0,h.useUserQuery)(),s=async()=>{try{let a=await g.authClient.getSession();a&&"data"in a&&a.data?i(!0):i(!1)}catch(a){i(!1)}finally{k(!1)}};(0,c.useEffect)(()=>{s()},[]);let t=async()=>{try{let a=await g.authClient.signIn.social({provider:"google",callbackURL:"/"});a&&"user"in a&&a.user&&i(!0)}catch(a){}},w=async()=>{try{let a=await g.authClient.signIn.social({provider:"google",callbackURL:"/?action=signup"});a&&"user"in a&&a.user&&i(!0)}catch(a){}},x=async()=>{try{await g.authClient.signOut(),i(!1),n.clear(),n.setQueryData(h.userQueryKeys.current(),null),n.setQueryData(l.all,void 0),n.setQueryData(u,void 0),await n.invalidateQueries({queryKey:["user"]}),await n.invalidateQueries({queryKey:l.all}),await n.invalidateQueries({queryKey:u}),o.push("/signin")}catch(a){}};return j||q?(0,b.jsx)("div",{children:"Loading..."}):(0,b.jsx)("div",{className:"flex items-center gap-2",children:a&&p?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("span",{className:"text-lg font-medium",children:["Hello, ",p.name||p.email,"!"]}),(0,b.jsx)(v.Button,{variant:"outline",onClick:x,children:m("signOut")})]}):(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(v.Button,{variant:"outline",onClick:t,children:m("signIn")}),(0,b.jsx)(v.Button,{onClick:w,children:m("signUp")})]})})}],39425);var w=a.i(59732),x=a.i(40582),y=a.i(39603);a.s(["default",0,a=>{let d,f,{searchQuery:g=""}=a,{data:j,isLoading:m,error:o}=(0,h.useUserQuery)(),{data:v,isLoading:z,error:A}=(d={enabled:!!j},(0,i.useQuery)({queryKey:l.search(g),queryFn:a=>k(a,{search:g}),enabled:d?.enabled!==!1})),{data:B}=(0,i.useQuery)({queryKey:u,queryFn:r}),C=(f=(0,e.useQueryClient)(),function(a,b){let d=(0,e.useQueryClient)(void 0),[f]=c.useState(()=>new q(d,a));c.useEffect(()=>{f.setOptions(a)},[f,a]);let g=c.useSyncExternalStore(c.useCallback(a=>f.subscribe(n.notifyManager.batchCalls(a)),[f]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),h=c.useCallback((a,b)=>{f.mutate(a,b).catch(p.noop)},[f]);if(g.error&&(0,p.shouldThrowError)(f.options.throwOnError,[g.error]))throw g.error;return{...g,mutate:h,mutateAsync:g.mutate}}({mutationFn:async a=>a.isFavorite?t(a.bookId):s(a.bookId),onMutate:async a=>{await f.cancelQueries({queryKey:u});let b=f.getQueryData(u)??[],c=a.isFavorite?b.filter(b=>b.id!==a.bookId):[...b,{id:a.bookId}];return f.setQueryData(u,c),{previous:b}},onError:(a,b,c)=>{c?.previous&&f.setQueryData(u,c.previous)},onSuccess:()=>{f.invalidateQueries({queryKey:u})}})),D=Array.isArray(B)?B:[];return!j||o?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Books from Database"}),(0,b.jsx)(x.Card,{children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"text-muted-foreground text-center",children:"Please sign in to view books"})})})]}):m?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Books from Database"}),(0,b.jsx)("div",{className:"flex justify-center py-8",children:(0,b.jsx)(x.Card,{className:"w-64",children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"text-muted-foreground text-center",children:"Loading..."})})})})]}):z?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Books from Database"}),(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((a,c)=>(0,b.jsxs)(x.Card,{children:[(0,b.jsxs)(x.CardHeader,{children:[(0,b.jsx)(y.Skeleton,{className:"h-5 w-3/4"}),(0,b.jsx)(y.Skeleton,{className:"mt-2 h-4 w-1/2"})]}),(0,b.jsxs)(x.CardContent,{children:[(0,b.jsx)(y.Skeleton,{className:"h-4 w-1/3"}),(0,b.jsx)(y.Skeleton,{className:"mt-3 h-4 w-full"}),(0,b.jsx)(y.Skeleton,{className:"mt-2 h-4 w-5/6"})]})]},c))})]}):A?(0,b.jsx)("div",{className:"flex justify-center py-8",children:(0,b.jsx)(x.Card,{className:"border-destructive w-64",children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"text-destructive text-center",children:"Error loading books"})})})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Books from Database"}),v&&0===v.length?(0,b.jsx)(x.Card,{children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"text-muted-foreground text-center",children:"No books found"})})}):(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:v?.map(a=>(0,b.jsx)(w.default,{title:a.title,author:a.author,publishedYear:a.publishedYear,description:a.description,href:`/${a.id}`,isFavorite:D.some(b=>b.id===a.id),onToggle:()=>C.mutate({bookId:a.id,isFavorite:D.some(b=>b.id===a.id)}),loading:C.isPending},a.id))})]})}],71225);var z=a.i(95245),A=a.i(55405),B=a.i(46640);a.s(["default",0,a=>{let{onSearch:c,initialValue:e=""}=a,f=(0,d.useTranslations)(),g=(0,z.useForm)({defaultValues:{query:e}});return(0,b.jsx)(A.Form,{...g,children:(0,b.jsx)("form",{onSubmit:g.handleSubmit(a=>{c(a.query)}),className:"w-full max-w-md",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(A.FormField,{control:g.control,name:"query",rules:{maxLength:{value:100,message:"Query too long"}},render:({field:a})=>(0,b.jsxs)(A.FormItem,{className:"flex-1",children:[(0,b.jsx)(A.FormControl,{children:(0,b.jsx)(B.Input,{...a,placeholder:f("Search.placeholder"),className:"w-full"})}),(0,b.jsx)(A.FormMessage,{})]})}),(0,b.jsx)(v.Button,{type:"submit",disabled:g.formState.isSubmitting,className:"shrink-0",children:g.formState.isSubmitting?f("Search.searching"):f("Search.button")})]})})})}],75192),a.i(6764),a.s([],20016)}];

//# sourceMappingURL=_8c2e4003._.js.map